<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PCB Quote (Internal)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
<header><h1>PCB Quotation — Internal</h1></header>

<div class="page-layout">
  <div class="page-main">
    {% if error_msgs and error_msgs|length %}
    <div class="alert">
      <ul>
        {% for m in error_msgs %}<li>{{ m }}</li>{% endfor %}
      </ul>
    </div>
    {% endif %}

    <form method="post" novalidate>
      <section>
        <h2>Board Basics</h2>
        <div class="grid">
          <label>Width (mm)
            <input name="width" type="number" step="1" value="{{ values.width }}">
          </label>
          <label>Height (mm)
            <input name="height" type="number" step="1" value="{{ values.height }}">
          </label>
          <label>Boards per panel
            <input name="panel_boards" type="number" step="1" value="{{ values.panel_boards }}">
          </label>
        </div>
      </section>

      <section>
        <h2>Materials</h2>
        <div class="grid">
          <label>Material
            <select name="material">
              {% for m in ["FR-4 KB6160A","Rogers 4350B"] %}
              <option value="{{ m }}" {% if values.material==m %}selected{% endif %}>{{ m }}</option>
              {% endfor %}
            </select>
          </label>
          <label>干膜
            <input name="film_cost" type="number" step="1" value="{{ values.film_cost }}">
          </label>
        </div>
      </section>

      <section>
        <h2>Treatment</h2>
        <div class="grid">
          <label>Layers
            <input name="layers" type="number" step="1" value="{{ values.layers }}">
          </label>
          <label>Finish
            <select name="finish">
              {% for f in ["HASL","ENIG","OSP"] %}
              <option value="{{ f }}" {% if values.finish==f %}selected{% endif %}>{{ f }}</option>
              {% endfor %}
            </select>
          </label>
          <label>Etching
            <input name="etching_cost" type="number" step="1" value="{{ values.etching_cost }}">
          </label>
          <label>Masking
            <input name="masking_cost" type="number" step="1" value="{{ values.masking_cost }}">
          </label>
          <label>Silkscreen
            <input name="silkscreen_cost" type="number" step="1" value="{{ values.silkscreen_cost }}">
          </label>
        </div>
      </section>

      <section>
        <h2>Process</h2>
        <div class="grid">
          <label>Via type
            <select name="via_type">
              {% for v in ["thru","blind","buried","micro"] %}
              <option value="{{ v }}" {% if values.via_type==v %}selected{% endif %}>{{ v }}</option>
              {% endfor %}
            </select>
          </label>
          <label>直 PTH
            <input name="direct_pth_holes" type="number" step="1" min="0" value="{{ values.direct_pth_holes }}">
          </label>
          <label>CNC 钻孔
            <input name="cnc_pth_holes" type="number" step="1" min="0" value="{{ values.cnc_pth_holes }}">
          </label>
          <label>开料
            <input name="cutting_cost" type="number" step="1" min="0" value="{{ values.cutting_cost }}">
          </label>
          <label>锣板/冲板
            <input name="routing_cost" type="number" step="1" min="0" value="{{ values.routing_cost }}">
          </label>
        </div>
      </section>

      <section>
        <h2>Sewage</h2>
        <div class="grid">
          <label>Water
            <input name="sewage_water" type="number" step="1" value="{{ values.sewage_water }}">
          </label>
          <label>Electricity
            <input name="sewage_electricity" type="number" step="1" value="{{ values.sewage_electricity }}">
          </label>
        </div>
      </section>

      <section>
        <h2>QA & Logistics</h2>
        <div class="grid">
          <label>IPC class
            <select name="ipc_class">
              {% for c in ["2","3"] %}
              <option value="{{ c }}" {% if values.ipc_class==c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
          </label>
          <label>E-test
            <select name="etest">
              {% for e in ["none","flying_probe","fixture"] %}
              <option value="{{ e }}" {% if values.etest==e %}selected{% endif %}>{{ e }}</option>
              {% endfor %}
            </select>
          </label>
          <label>Lead time
            <select name="lead_time_class">
              {% for lt in ["economy","standard","express"] %}
              <option value="{{ lt }}" {% if values.lead_time_class==lt %}selected{% endif %}>{{ lt }}</option>
              {% endfor %}
            </select>
          </label>
          <label>Ship zone
            <select name="ship_zone">
              {% for z in ["ASIA","EU","NA","OTHER"] %}
              <option value="{{ z }}" {% if values.ship_zone==z %}selected{% endif %}>{{ z }}</option>
              {% endfor %}
            </select>
          </label>
        </div>
      </section>

      <div class="actions">
        <button type="submit">Calculate</button>
      </div>
    </form>
  </div>

  <aside class="page-summary">
    <section class="summary-card">
      <h2>Live Summary</h2>
      {% if result %}
      <div class="grid">
        <div>
          <h3>Breakdown</h3>
          <ul class="mono">
            <li>Material: {{ result.breakdown.material.total }}
              <ul>
                <li>Laminate: {{ result.breakdown.material.components.laminate }}</li>
                <li>Film: {{ result.breakdown.material.components.film }}</li>
              </ul>
            </li>
            <li>Treatment: {{ result.breakdown.treatment.total }}
              <ul>
                <li>Finish: {{ result.breakdown.treatment.components.finish }}</li>
                <li>Etching: {{ result.breakdown.treatment.components.etching }}</li>
                <li>Masking: {{ result.breakdown.treatment.components.masking }}</li>
                <li>Silkscreen: {{ result.breakdown.treatment.components.silkscreen }}</li>
              </ul>
            </li>            
            <li>Process: {{ result.breakdown.process.total }}
              <ul>
                <li>直 PTH: {{ result.breakdown.process.components.direct_pth }}</li>
                <li>CNC 钻孔: {{ result.breakdown.process.components.cnc_pth }}</li>
                <li>开料: {{ result.breakdown.process.components.cutting }}</li>
                <li>锣板/冲板: {{ result.breakdown.process.components.routing }}</li>
              </ul>
            </li>
            <li>Sewage: {{ result.breakdown.sewage.total }}
              <ul>
                <li>Water: {{ result.breakdown.sewage.components.water }}</li>
                <li>Electricity: {{ result.breakdown.sewage.components.electricity }}</li>
              </ul>
            </li>
            <li>QA: {{ result.breakdown.qa.total }}
              <ul>
                <li>AOI: {{ result.breakdown.qa.components.aoi }}</li>
                <li>E-test: {{ result.breakdown.qa.components.etest }}</li>
              </ul>
            </li>
            <li>Overhead: {{ result.breakdown.overhead }}</li>
            <li>Risk: {{ result.breakdown.risk }}</li>
            <li>Boards per panel: {{ result.breakdown.boards_per_panel }}</li>
            <li>Yield (%): {{ result.breakdown.yield_pct_effective }}</li>
            <li>COGS: {{ result.cogs }}</li>
          </ul>
        </div>
        <div>
          <h3>Panel Pricing</h3>
          <ul class="mono">
            <li>Sell price (panel): {{ result.price_total }}</li>
            <li>COGS (panel): {{ result.cogs }}</li>
            <li>Unit price (board): {{ result.unit_price_board }}</li>
          </ul>
        </div>
      </div>
      {% else %}
      <p class="summary-placeholder">Fill out the form to see pricing details here.</p>
      {% endif %}
    </section>
  </aside>
</div>

<footer><small>Minimal internal tool. Defaults are editable.</small></footer>
</body>
</html>
